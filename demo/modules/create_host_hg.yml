---
- name: Create host
  dellemc_powerstore_host:
    array_ip: "{{array_ip}}"
    verifycert: "{{verifycert}}"
    user: "{{user}}"
    password: "{{password}}"
    host_name: "{{ inventory_hostname }}"
    os_type: 'Windows'
    initiators: "{{ initiator }}"
    state: 'present'
    initiator_state: 'present-in-host'

- name: Create host group with hosts using host name
  dellemc_powerstore_hostgroup:
    array_ip: "{{array_ip}}"
    verifycert: "{{verifycert}}"
    user: "{{user}}"
    password: "{{password}}"
    hostgroup_name: "{{ group_names[0] }}"
    hosts: "{{ groups[group_names[0]] }}"
    state: 'present'
    host_state: 'present-in-group'
  run_once: True
